#generate extracted chlorophyll mosaic from existing chlext.tif(s)

BASEDIR=/home/jose/Documents/Science/Data/Dataflow
SURFACES=$(wildcard $(BASEDIR)/DF_Surfaces/*)
#COEF_FILE=$(BASEDIR)/DF_GrabSamples/extractChlcoef2.csv
#CSV_FILES=$(wildcard $(BASEDIR)/DF_FullDataSets/*.csv)
#LOG_FILES=$(wildcard logs/*.log)
#SURVEY_FILE=yearmonfits.csv
GRASSTEST=$(BASEDIR)/QGIS_plotting/201311.pdf
LEGEND_FILE=$(BASEDIR)/QGIS_plotting/legend/legend.pdf


.PHONY : variables
variables:
	@echo BASEDIR: $(BASEDIR)
#	@echo COEF_FILE: $(COEF_FILE)
#	@echo CSV_FILES: $(CSV_FILES)
#	@echo TIF_FILES: $(TIF_FILES)
#	@echo LOG_FILES: $(LOG_FILES)
	@echo GRASSTEST: $(GRASSTEST)


yearmonfits.csv: $(COEF_FILE)
	-Rscript R/chlextlist.R $< $@

$(BASEDIR)/DF_Surfaces/%/chlext.tif: $(LOG_FILES) yearmonfits.csv
	-Rscript R/chlext.R $< $@


#create a "log" file for each survey that has an acceptable model fit
logs/%fit.log: $(COEF_FILE) $(BASEDIR)/DF_FullDataSets/%.csv
	-Rscript R/chlextlist.R $< $@

.PHONY: logsall
logsall: $(LOG_FILES)	

#find csv files
#find chlext surfaces


#find grassmap plots
testpanel.png: $(GRASSTEST)
	convert $(GRASSTEST) -trim -geometry +6+6 -bordercolor black -border 5x5 tile.png
	convert $(LEGEND_FILE) -crop 278x8+42+92 -fuzz 40% -fill white -opaque grey -trim -resize 2404x3592 legend.png
	convert legend.png -bordercolor black -border 5x5 -background white -extent 2404x220 +repage legend2.png
	convert legend2.png -interword-spacing 250 -pointsize 40 -fill black -draw "text 2140,140 'Chlorophyll'" legend3.png	
	convert legend3.png -interword-spacing 265 -pointsize 55 -fill black -draw "text 20,140 '0.0 0.7 1.5 3.0 6.0 10.0'" -resize 534x legend4.png
	convert /home/jose/Documents/Science/Data/Dataflow/DF_Basefile/sfwmd_bar8half_wordorexcel.png -resize 534x sfwmdbar.png
	montage sfwmdbar.png tile.png legend4.png -tile x3 -geometry +1+1 -bordercolor white -border 1x1 testpanel.png

.PHONY: clean
clean:
	rm -f testpanel.png
	rm -f legend*.png
	rm -f sfwmdbar.png
	rm -f tile.png

#montage plots
#UNFINISHED DO  NOT RUN!!!
